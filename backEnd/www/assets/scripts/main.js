!function(t,i){var a={init:function(){this.bindDialog()},openRuleDialog:function(){this.initDialog(i("#rule_dialog")),i("#mask").height(i(document).innerHeight()),i("#mask").fadeIn(),i("#rule_dialog").fadeIn()},bindDialog:function(){var t=this;i(".dialog .icon-close").on("click touchend",function(t){t.stopPropagation(),i("#mask").fadeOut(),i(this).parents(".dialog").fadeOut()}),i(".rule_text").on("click touchend",function(i){i.preventDefault(),i.stopPropagation(),t.track("Button-rule"),t.openRuleDialog()})},initDialog(a){if(!a)return!1;var n=i(t).height(),o=i(document).scrollTop(),e=a.height();n-e<0?a.css({top:30}):a.css({top:(n-e)/2+o})},track:function(t){if("undefined"==typeof mixpanel)return!1;mixpanel.track(t)}};a.init(),t.ruleDialog=a}(window,jQuery),function(t,i){var a=i("#year"),n=i("#month"),o=i("#day"),e=i("#order"),r=i("#changeAble");({init:function(){this.bind(),"0"!=i("#order").val()&&this.TiggerDialog()},bind:function(){var e=this;i("body").on("focusout",function(t){i("body").animate({scrollTop:0},1e3)}),i("#year , #month").on("change",function(t){var i=new Date(a.val(),n.val(),0);e.setCurDays(i.getDate(),o.val())}),i("#dyear, #dmonth").on("change",function(t){var a=new Date(i("#dyear").val(),i("#dmonth").val(),0);e.setCurDays(a.getDate(),i("#dday").val(),!0)}),i(".submit_btn").on("click touchend",function(t){t.preventDefault(),t.stopPropagation(),e.track("Button-dob-submit"),e.getFormData()}),i("#fixBirthday_dialog .confirm-btn").on("click touchend",function(t){t.preventDefault(),t.stopPropagation(),e.track("Button-revise-submit"),e.getFormData(!0)}),i(".rule_text").on("click touchend",function(i){i.preventDefault(),i.stopPropagation(),t.ruleDialog.openRuleDialog()})},TiggerDialog:function(){var t=this;i("#year, #month, #day").on("click, touchend",function(a){return a.stopPropagation(),a.preventDefault(),"0"!==i("#order").val()&&"0"===i("#changeAble").val()?(t.changeBirthdayDialog(),!1):i(this).attr("disabled")?(t.tipCantChangeDialog(),!1):void 0})},setCurDays:function(t,a,n){if(t<=0)return!1;a>t&&(a="");for(var e='<option value="">请选择</option>',r=1;r<=t;r++){var l="";""!=a&&(a!=r&&a!="0"+r||(l="selected")),e+=r<10?'<option value="0'+r+'" '+l+">0"+r+"</option>":'<option value="'+r+'"'+l+">"+r+"</option>"}n?i("#dday").html(e).val(a):o.html(e).val(a)},getFormData:function(l){var u=r.val(),s=e.val(),c=a.val(),d=n.val(),h=o.val();if(0==s)l||this.postDob(c,d,h,s,u);else if(0==u)if(l)this.postDob(i("#dyear").val(),i("#dmonth").val(),i("#dday").val(),s,u);else{var g=i(".submit_btn").attr("suc_to");t.setTimeout(function(){t.location.href=g||"detail.php"},500)}else{g=i(".submit_btn").attr("suc_to");t.setTimeout(function(){t.location.href=g||"detail.php"},500)}},initDialog:function(a){if(!a)return!1;var n=i(t).height(),o=i(document).scrollTop(),e=a.height();n-e<0?a.css({top:30}):a.css({top:(n-e)/2+o})},postDob:function(a,n,o,e,r){var l=this;if(!a||!n||!o)return l.showErrTip("请选择宝宝生日/预产期！"),!1;this.showLoadingToast(),i.post(urlMap.postDob,{year:a,month:n,day:o,order:e||0,changed:r||0}).then(function(a){l.hideLoadingToast();var n=a;if(0===n.errno){var o=i(".submit_btn").attr("suc_to");t.setTimeout(function(){t.location.href=o||"detail.php"},500)}else l.showErrTip(n.err)})},changeBirthdayDialog:function(){this.track("window-revise"),i("#mask").height(i(document).innerHeight()),this.initDialog(i("#fixBirthday_dialog"));var t=new Date(a.val(),n.val(),0);i("#dyear").val(a.val()),i("#dmonth").val(n.val()),this.setCurDays(t.getDate(),o.val(),!0),i("#mask").fadeIn(),i("#fixBirthday_dialog").fadeIn()},tipCantChangeDialog:function(){i("#mask").height(i(document).innerHeight()),this.initDialog(i("#cantFix_dialog")),i("#mask").fadeIn(),i("#cantFix_dialog").fadeIn()},showLoadingToast:function(){i("#loadingToast").show()},hideLoadingToast:function(){i("#loadingToast").hide()},showErrTip:function(t){i("#mask").height(i(document).innerHeight()),this.initDialog(i("#errTip_dialog")),i("#errTip_dialog .errTip").html(t),i("#mask").fadeIn(),i("#errTip_dialog").fadeIn()},track:function(t){if("undefined"==typeof mixpanel)return!1;mixpanel.track(t)}}).init()}(window,jQuery);